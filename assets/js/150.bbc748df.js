(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{747:function(e,t,o){"use strict";o.r(t);var s=o(24),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h6",{attrs:{id:"原文-掘金"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#原文-掘金"}},[e._v("#")]),e._v(" 原文 "),o("a",{attrs:{href:"https://juejin.cn/post/7206264862657445947",target:"_blank",rel:"noopener noreferrer"}},[e._v("掘金"),o("OutboundLink")],1)]),e._v(" "),o("div",{staticClass:"markdown-body cache"},[o("p",[e._v("测试妹子给我提了个"),o("code",[e._v("bug")]),e._v(",说为什么一次操作，"),o("code",[e._v("network")]),e._v("里面两个请求。")]),e._v(" "),o("p",[e._v("我脸色一变”不可能，我写的代码明明是一次操作，怎么可能两个请求“。走过去一看，原来是多了个"),o("code",[e._v("options")]),e._v("请求。")]),e._v(" "),o("p",[e._v("”这个你不用管，这个是浏览器默认发送的一个预检请求“。可是妹子很执着”这可肯定不行啊，明明是一次请求，干嘛要两次呢？“。")]),e._v(" "),o("p",[e._v("”哟呵，挺固执啊，那我就给你讲个明白，到时候你可别说听不懂“。")]),e._v(" "),o("p",[e._v("HTTP的请求分为两种"),o("strong",[e._v("简单请求")]),e._v("和"),o("strong",[e._v("非简单请求")])]),e._v(" "),o("h2",{attrs:{id:"简单请求"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[e._v("#")]),e._v(" 简单请求")]),e._v(" "),o("p",[e._v("简单请求要满足两个条件：")]),e._v(" "),o("ol",[o("li",[e._v("请求方法为："),o("code",[e._v("HEAD")]),e._v("、"),o("code",[e._v("GET")]),e._v("、"),o("code",[e._v("POST")])]),e._v(" "),o("li",[o("code",[e._v("header")]),e._v("中只能包含以下请求头字段：\n"),o("ul",[o("li",[o("code",[e._v("Accept")])]),e._v(" "),o("li",[o("code",[e._v("Accept-Language")])]),e._v(" "),o("li",[o("code",[e._v("Content-Language")])]),e._v(" "),o("li",[o("code",[e._v("Content-Type")]),e._v(": 所指的媒体类型值仅仅限于下列三者之一\n"),o("ul",[o("li",[o("code",[e._v("text/plain")])]),e._v(" "),o("li",[o("code",[e._v("multipart/form-data")])]),e._v(" "),o("li",[o("code",[e._v("application/x-www-form-urlencoded")])])])])])])]),e._v(" "),o("h3",{attrs:{id:"浏览器的不同处理方式"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的不同处理方式"}},[e._v("#")]),e._v(" 浏览器的不同处理方式")]),e._v(" "),o("p",[e._v("对于简单请求来说，如果请求跨域，那么浏览器会放行让请求发出。浏览器会发出"),o("code",[e._v("cors")]),e._v("请求，并携带"),o("code",[e._v("origin")]),e._v("。此时不管服务端返回的是什么，浏览器都会把返回拦截，并检查返回的"),o("code",[e._v("response")]),e._v("的"),o("code",[e._v("header")]),e._v("中有没有"),o("code",[e._v("Access-Control-Allow-Origin")]),e._v("是否为"),o("code",[e._v("true")]),e._v("，说明资源是共享的，可以拿到。如果没有这个头信息，说明服务端没有开启资源共享，浏览器会认为这次请求失败终止这次请求，并且报错。")]),e._v(" "),o("h2",{attrs:{id:"非简单请求"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求"}},[e._v("#")]),e._v(" 非简单请求")]),e._v(" "),o("p",[e._v("只要不满足简单请求的条件，都认为是非简单请求。")]),e._v(" "),o("p",[e._v("发出非简单"),o("code",[e._v("cors")]),e._v("请求，浏览器会做一个"),o("code",[e._v("http")]),e._v("的查询请求（预检请求）也就是"),o("code",[e._v("options")]),e._v("。"),o("code",[e._v("options")]),e._v("请求会按照简单请求来处理。那么为什么会做一次"),o("code",[e._v("options")]),e._v("请求呢？")]),e._v(" "),o("p",[e._v("检查服务器是否支持跨域请求，并且确认实际请求的"),o("strong",[e._v("安全性")]),e._v("。预检请求的目的是为了保护客户端的安全，防止不受信任的网站利用用户的浏览器向其他网站发送恶意请求。\n预检请求头中除了携带了"),o("code",[e._v("origin")]),e._v("字段还包含了两个特殊字段：")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("Access-Control-Request-Method")]),e._v("： 告知服务器实际请求使用的"),o("code",[e._v("HTTP")]),e._v("方法")]),e._v(" "),o("li",[o("code",[e._v("Access-Control-Request-Headers")]),e._v("：告知服务器实际请求所携带的自定义首部字段。\n比如：")])]),e._v(" "),o("div",{staticClass:"language-html line-numbers-mode"},[o("pre",{pre:!0,attrs:{class:"language-html"}},[o("code",[e._v("OPTIONS /resources/post-here/ HTTP/1.1\nHost: bar.other\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nConnection: keep-alive\nOrigin: http://foo.example\nAccess-Control-Request-Method: POST\nAccess-Control-Request-Headers: X-PINGOTHER, Content-Type\n\n")])]),e._v(" "),o("div",{staticClass:"line-numbers-wrapper"},[o("span",{staticClass:"line-number"},[e._v("1")]),o("br"),o("span",{staticClass:"line-number"},[e._v("2")]),o("br"),o("span",{staticClass:"line-number"},[e._v("3")]),o("br"),o("span",{staticClass:"line-number"},[e._v("4")]),o("br"),o("span",{staticClass:"line-number"},[e._v("5")]),o("br"),o("span",{staticClass:"line-number"},[e._v("6")]),o("br"),o("span",{staticClass:"line-number"},[e._v("7")]),o("br"),o("span",{staticClass:"line-number"},[e._v("8")]),o("br"),o("span",{staticClass:"line-number"},[e._v("9")]),o("br"),o("span",{staticClass:"line-number"},[e._v("10")]),o("br"),o("span",{staticClass:"line-number"},[e._v("11")]),o("br")])]),o("p",[e._v("以上报文中就可以看到，使用了"),o("code",[e._v("OPTIONS")]),e._v("请求，浏览器根据上面的使用的请求参数来决定是否需要发送，这样服务器就可以回应是否可以接受用实际的请求参数来发送请求。"),o("code",[e._v("Access-Control-Request-Method")]),e._v("告知服务器，实际请求将使用 "),o("code",[e._v("POST")]),e._v(" 方法。"),o("code",[e._v("Access-Control-Request-Headers")]),e._v("告知服务器，实际请求将携带两个自定义请求标头字段："),o("code",[e._v("X-PINGOTHER")]),e._v(" 与 "),o("code",[e._v("Content-Type")]),e._v("。服务器据此决定，该实际请求是否被允许。")]),e._v(" "),o("p",[e._v("什么时候会触发预检请求呢？")]),e._v(" "),o("ol",[o("li",[e._v("发送跨域请求时，请求头中包含了一些非简单请求的头信息，例如自定义头（custom header）等；")]),e._v(" "),o("li",[e._v("发送跨域请求时，使用了 PUT、DELETE、CONNECT、OPTIONS、TRACE、PATCH等请求方法。")])]),e._v(" "),o("p",[e._v("我得意的说“讲完了，老妹你听懂了吗？”")]),e._v(" "),o("p",[e._v("妹子说“似懂非懂”")]),e._v(" "),o("p",[e._v("那行吧，带你看下实际场景。（借鉴文章"),o("a",{ref:"nofollow noopener noreferrer",attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Famandakelake%2Fblog%2Fissues%2F62",target:"_blank",title:"https://github.com/amandakelake/blog/issues/62"}},[e._v("CORS 简单请求+预检请求（彻底理解跨域）")]),e._v("的两张图）")]),e._v(" "),o("p",[o("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67cf1327ec8649ab94342441cf4295e4~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?",alt:"image.png",loading:"lazy"}})]),e._v(" "),o("p",[o("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/758d19be3575467bb53ccd8fd225b174~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image?",alt:"image.png",loading:"lazy"}})]),e._v(" "),o("p",[e._v("妹子说“这样就明了很多”，满是崇拜的关闭了Bug。")]),e._v(" "),o("p",[e._v("兄弟们，妹子都懂了，你懂了吗？😄")]),e._v(" "),o("p",[e._v("参考：")]),e._v(" "),o("p",[o("a",{ref:"nofollow noopener noreferrer",attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Famandakelake%2Fblog%2Fissues%2F62",target:"_blank",title:"https://github.com/amandakelake/blog/issues/62"}},[e._v("CORS 简单请求+预检请求（彻底理解跨域）")])]),e._v(" "),o("p",[o("a",{ref:"nofollow noopener noreferrer",attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FMethods%2FOPTIONS",target:"_blank",title:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/OPTIONS"}},[e._v("OPTIONS | MDN")])]),e._v(" "),o("p",[o("a",{ref:"nofollow noopener noreferrer",attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCORS",target:"_blank",title:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS"}},[e._v("跨源资源共享（CORS）| MDN")])]),e._v(" "),o("p",[e._v("说明一下哈，以上事件是真实事件，只不过当时讲的时候没有那么的详细，😂")])])])}),[],!1,null,null,null);t.default=n.exports}}]);